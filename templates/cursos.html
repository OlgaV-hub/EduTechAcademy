<!-- templates/cursos.html -->

{% extends "base.html" %}
{% block content %}

{% if not panel %}
<div class="img-fluid mb-4 banner-cursos">
    <img src="{{ url_for('static', filename='img/cursos_baner3.png') }}"
         class="img-fluid rounded shadow">
</div>
{% endif %}

{% if panel in ['admin', 'profesor'] %}
  <div class="row g-4">
    <div class="col-12 col-md-3">
      {% if active is not defined %}
        {% set active = 'mis_cursos' %}
      {% endif %}
      {% include "_sidebar.html" %}
    </div>

    <div class="col-12 col-md-9">
      <h2 class="mb-3">{{ titulo or 'Listado de cursos' }}</h2>

      <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
        {% for c in cursos %}
          <div class="col">
            <div class="card course-card h-100 shadow-sm">

              {% if c.image_key %}
                <img src="{{ url_publica(c.image_key) }}"
                     alt="Imagen del curso {{ c.nombre }}"
                     class="course-image">
              {% endif %}

              <div class="card-body">
                <h5 class="card-title">{{ c.nombre }}</h5>
                <p class="card-text text-muted">{{ c.descripcion or '—' }}</p>

                <div class="d-flex justify-content-between align-items-center">
                  <span class="fw-semibold">
                    USD {{ '%.2f'|format(c.precio or 0) }}
                  </span>

                  {# ---- Ver inscripciones для admin/prof ---- #}
                  {% if current_user.is_authenticated and current_user.role in ('admin', 'profesor') %}

                    {% if current_user.role == 'admin' %}
                      <a class="btn btn-outline-primary btn-sm ms-2"
                         href="{{ url_for('admin.admin_ver_inscripciones_curso', course_id=c.id) }}">
                        Ver inscripciones
                      </a>
                    {% else %}
                      <a class="btn btn-outline-primary btn-sm ms-2"
                         href="{{ url_for('profesor.gestionar_inscripciones_curso', course_id=c.id) }}">
                        Ver inscripciones
                      </a>
                    {% endif %}

                    <a class="btn btn-outline-secondary btn-sm ms-2"
                       href="{{ url_for('courses.editar_curso', course_id=c.id) }}">
                      Editar
                    </a>

                    <form method="post"
                          action="{{ url_for('courses.eliminar_curso', course_id=c.id) }}"
                          style="display:inline-block"
                          onsubmit="return confirm('¿Eliminar el curso?');">
                      <button class="btn btn-outline-danger btn-sm ms-1" type="submit">
                        Eliminar
                      </button>
                    </form>
                  {% endif %}
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>

    </div>
  </div>

{% else %}
  {# ---------- Lista pública (para quienes no han iniciado sesión y todos los demás) ---------- #}
  <h2 class="mb-3">Listado de cursos</h2>

  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    {% for c in cursos %}
      <div class="col">
        <div class="card course-card h-100 shadow-sm">

          {% if c.image_key %}
            <img src="{{ url_publica(c.image_key) }}"
                 alt="Imagen del curso {{ c.nombre }}"
                 class="course-image">
          {% endif %}

          <div class="card-body">
            <h5 class="card-title">{{ c.nombre }}</h5>
            <p class="card-text text-muted">{{ c.descripcion or '—' }}</p>

            <div class="d-flex justify-content-between align-items-center">
              <span class="fw-semibold">
                USD {{ '%.2f'|format(c.precio or 0) }}
              </span>

              <a class="btn btn-primary btn-sm"
                 href="{{ url_for('courses.detalle_curso', course_id=c.id) }}">
                Ver detalle
              </a>
            </div>
          </div>
        </div>
      </div>
    {% endfor %}
  </div>

{% endif %}

{% endblock %}